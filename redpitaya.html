
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="img/orbit.png">
      <meta name="generator" content="mkdocs-1.2, mkdocs-material-7.1.7">
    
    
      
        <title>Red Pitaya - Vestaia</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.ca7ac06f.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.f1a3b89f.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL(".",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#red-pitaya" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="Vestaia" class="md-header__button md-logo" aria-label="Vestaia" data-md-component="logo">
      
  <img src="img/orbit.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Vestaia
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Red Pitaya
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Vestaia" class="md-nav__button md-logo" aria-label="Vestaia" data-md-component="logo">
      
  <img src="img/orbit.png" alt="logo">

    </a>
    Vestaia
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="linux.html" class="md-nav__link">
        How to Linux
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="development.html" class="md-nav__link">
        Development
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="digital.html" class="md-nav__link">
        FPGA
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Red Pitaya
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="redpitaya.html" class="md-nav__link md-nav__link--active">
        Red Pitaya
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#building-and-setup" class="md-nav__link">
    Building and Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#addressmemory-layout" class="md-nav__link">
    Address/Memory Layout
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ring-buffer" class="md-nav__link">
    Ring Buffer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#daq-project-file-structure" class="md-nav__link">
    DAQ Project File Structure
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="extern.html" class="md-nav__link">
        External Resources
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="opportunity.html" class="md-nav__link">
        Opportunities/Funding
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="projects.html" class="md-nav__link">
        Projects
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#building-and-setup" class="md-nav__link">
    Building and Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#addressmemory-layout" class="md-nav__link">
    Address/Memory Layout
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ring-buffer" class="md-nav__link">
    Ring Buffer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#daq-project-file-structure" class="md-nav__link">
    DAQ Project File Structure
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="red-pitaya"><strong>Red Pitaya</strong></h1>
<p>The Red Pitaya is a data aquisition platform with an integrated ADC and FPGA. This page documents the firmware and software system used to operate the Red Pitaya for the data aquisition application.</p>
<h2 id="building-and-setup"><strong>Building and Setup</strong></h2>
<p>The <a href="https://github.com/Vestaia/DSP">DAQ project</a> requires an implementation of the standard c libraries and math libraries. The easiest way to satisfy dependencies is to install a linux system. Pavel Demin has made a repository containing scripts to install a linux system and required applications for booting. If you use Pavel's build scripts, you must allocate 256MB of memory for the FPGA DMA. There are two ways to do this, either</p>
<ul>
<li>Modify <code>red-pitaya-notes/patches/devicetree.patch</code> and add </li>
</ul>
<pre><code>@@ -24,6 +36,6 @@
    };
    memory {
        device_type = &quot;memory&quot;;
 -      reg = &lt;0x0 0x20000000&gt;;
 +      reg = &lt;0x0 0x10000000&gt;;
    };
  };
</code></pre>
<ul>
<li>or add to your kernel boot arguments <code>cma=256M</code> in <code>red-pitaya-notes/uEnv.txt</code>.</li>
</ul>
<p>You can then generate your preferred linux distribution. The scripts should generate a system with Xilinx's FPGA runtime reprogramming driver enabled. The FPGA is mapped to <code>/dev/xdevcfg</code>. You can write bitmaps to this in order to load a hardware definition, for instance</p>
<pre><code>cat zynq7010.bit &gt; /dev/xdevcfg
</code></pre>
<h2 id="addressmemory-layout"><strong>Address/Memory Layout</strong></h2>
<p>Devices are mapped to memory using a <a href="https://elinux.org/Device_Tree_Reference">device tree</a>. Some FPGA components are also mapped to DRAM over DMA. Some important addresses are</p>
<ul>
<li><code>0x0000_0000 - 0x0FFF_FFFF</code>: DRAM System Memory, managed by Linux<ul>
<li><code>+0x0200_0000</code>: Device tree load address <code>devicetree.dtb</code></li>
<li><code>+0x0208_0000</code>: Kernel load address <code>uImage</code></li>
<li><code>+0x0300_0000</code>: Linux Ramdisk load address <code>uInitrd</code></li>
</ul>
</li>
<li><code>0x1000_0000 - 0x11FF_FFFF</code>: DRAM FPGA Direct Memory Access Ring buffer</li>
<li><code>0x4000_0000 - 0x4000_0032</code>: FPGA Configuration registers<ul>
<li><code>+0x0 uint8</code>: Reset registers<ul>
<li><code>&lt;&lt; 0</code>: Unused</li>
<li><code>&lt;&lt; 1</code>: Data aquisition chain reset</li>
<li><code>&lt;&lt; 2</code>: DMA Writer reset</li>
<li><code>&lt;&lt; 3 - &lt;&lt; 7</code>: Unused</li>
</ul>
</li>
<li><code>+0x8 uint16</code>: Trapezoid K-delay</li>
<li><code>+0x10 uint16</code>: Trapezoid L-delay</li>
<li><code>+0x12 uint16</code>: Trapezoid M shaping constant</li>
<li><code>+0x16 uint16</code>: Trigger Threshhold for event capturing</li>
</ul>
</li>
</ul>
<p>See the device tree files for device mappings.</p>
<h2 id="ring-buffer"><strong>Ring Buffer</strong></h2>
<p>The primary ring buffer contains sequential samples in the format</p>
<ul>
<li><code>uint32</code>: Time</li>
<li><code>uint16</code>: ADC Channel 1</li>
<li><code>uint16</code>: ADC Channel 2</li>
</ul>
<p>(Remember to disable <a href="https://en.wikipedia.org/wiki/Data_structure_alignment#Typical_alignment_of_C_structs_on_x86">struct padding</a> if using C/C++)</p>
<h2 id="daq-project-file-structure"><strong>DAQ Project File Structure</strong></h2>
<p>The organization of the <a href="https://github.com/Vestaia/DSP">github repository</a> for the DAQ project</p>
<ul>
<li><code>/cores</code>: Various IP modules for signal processing.</li>
<li><code>/pavel-cores</code>: IP modules imported from pavel's <code>red-pitaya-notes</code> project</li>
<li><code>/project</code>: Vivado project files</li>
<li><code>/software</code>: Drivers and programs for interfacing with the FP</li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="digital.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: FPGA" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              FPGA
            </div>
          </div>
        </a>
      
      
        
        <a href="extern.html" class="md-footer__link md-footer__link--next" aria-label="Next: External Resources" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              External Resources
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "assets/javascripts/workers/search.b0710199.min.js", "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.76f349be.min.js"></script>
      
        <script src="js/config.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>